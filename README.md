# Transport Catalogue

Программа предназначена для построения оптимальных маршрутов между автобусными остановками и отображения карты маршрутов в виде XML документа.

Интерфейс программы с пользователем реализован через стандартные потоки ввода и вывода. На вход программы подаются JSON-объекты, а на выходе программа возвращает JSON-массивы. Подробнее об этом в разделе "Структура запросов и ответов".

Например, для того чтобы получить ввод из файла `input_file.txt` и записать вывод в файл `output_file.txt`, введите в командной строке:
```sh
transport_catalogue.exe < input_file.txt > output_file.txt
```

## Поддерживаемый функционал
- Формирование транспортного справочника на основе: названия остановок, географических координат, расстояния между остановками в обоих направлениях, названия маршрутов (автобусов), названия остановок, через которые проходит маршрут.
- Получение информации о маршруте: длина маршрута, количество остановок, количество уникальных остановок, извилистость маршрута (равна отношению длины дорожного расстояния маршрута к длине географического расстояния).
- Отображение карты маршрутов в формате SVG.
- Построение оптимального маршрута (минимальное время поездки) между двумя заданными остановками. Определяет суммарное время поездки и элементы маршрута (остановки, автобусы).
- Обработка ошибок в случае если запрос не может быть выполнен.

## Структура запросов и ответов
<details>
  <summary>Нажмите чтобы раскрыть</summary>

## Формат входных данных
Данные поступают из входного потока в формате JSON-объекта.
```json
{
  "base_requests": [ ],
  "stat_requests": [ ],
  "render_settings": { },
  "routing_settings": { }
}
```
- `base_requests` — массив с описанием автобусных маршрутов и остановок.
- `stat_requests` — массив с запросами к транспортному справочнику.
- `render_settings` — словарь с настройками визуализации.
- `routing_settings` — словарь с настройками для построения маршрута.

## Описание маршрутов
Массив `base_requests` содержит маршруты и остановки.

**Описание остановки:**
```json
{
  "type": "Stop",
  "name": "Stop Name",
  "latitude": 12.345678,
  "longitude": 87.54321,
  "road_distances": {
    "Street 1": 700,
    "Street 2 ": 800
  }
}
```
- `type` — строка, всегда равна `"Stop"`.
- `name` — название остановки.
- `latitude` и `longitude` — широта и долгота остановки.
- `road_distances` — словарь, задаёт расстояние от данной остановки до соседних.

**Описание маршрута:**
```json
{
  "type": "Bus",
  "name": "Bus Name",
  "stops": [
    "Stop Name 1",
    "Stop Name 2"
  ],
  "is_roundtrip": false
}
```
- `type` — строка, всегда равна `"Bus"`.
- `name` — название маршрута.
- `stops` — массив с названиями остановок, которые образуют маршрут. У кольцевого маршрута название последней остановки совпадает с первой.
- `is_roundtrip` — значение типа `bool`. `true`, если маршрут кольцевой.

## Настройки построения маршрута
Объект `routing_settings` — это словарь с двумя ключами:
- `bus_wait_time` — время ожидания автобуса на остановке, в минутах.
- `bus_velocity` — скорость автобуса, в км/ч.

Пример:
```json
"routing_settings": {
  "bus_wait_time": 10,
  "bus_velocity": 30
}
```

## Настройки визуализации
Для настроек визуализации ииспользуется словарь `render_settings`:
```json
{
  "width": 1100.0,
  "height": 1100.0,
  "padding": 25.0,
  "line_width": 10.0,
  "stop_radius": 4.0,
  "bus_label_font_size": 12,
  "bus_label_offset": [5.0, 8.0],
  "stop_label_font_size": 12,
  "stop_label_offset": [2.0, -2.0],
  "underlayer_color": [240, 240, 240, 0.5],
  "underlayer_width": 2.0,
  "color_palette": [
    "red",
    "blue",
    [140, 140, 140]
  ]
}
```
- `width` и `height` — ширина и высота изображения в пикселях.
- `padding` — отступ краёв карты от границ SVG-документа.
- `line_width` — толщина линий автобусных маршрутов.
- `stop_radius` — радиус окружностей остановок.
- `bus_label_font_size` — размер текста названий автобусных маршрутов.
- `bus_label_offset` — смещение надписи названия маршрута относительно координат конечной остановки.
- `stop_label_font_size` — размер текста названий остановок.
- `stop_label_offset` — смещение названия остановки относительно координат на карте.
- `underlayer_color` — цвет фонового текста под названиями остановок и маршрутов.
- `underlayer_width` — толщина фонового текста.
- `color_palette` — палитра цветов. Поддерживаются 3 формата: строка, компоненты r, g, b, компоненты r, g, b,a.

## Формат запросов и ответов к транспортному справочнику
Запросы хранятся в массиве `stat_requests`. Ответы формируются в виде JSON-массива:
```json
[ { }, { } ]
```
Каждый запрос обязательно должен содержать ключи `id` и `type`. Это числовой идентефекатор запроса и его тип. `id` соответствует `request_id` в выходном объекте.

**Получение информации о маршруте**
```json
{
  "id": 1,
  "type": "Bus",
  "name": "Bus Name"
}
```
- `type` — имеет значение `"Bus"`.
- `name` — название маршрута, для которого необходимо вывести статистику.

Ответ на данный запрос имеет вид:
```json
{
  "curvature": 1.15,
  "request_id": 1,
  "route_length": 7800,
  "stop_count": 3,
  "unique_stop_count": 2
}
```
- `curvature` — извилистость маршрута. Равна отношению длины дорожного расстояния маршрута к длине географического расстояния.
- `request_id` — равен `id` запроса `Bus`.
- `route_length` — длина расстояния маршрута в метрах.
- `stop_count` — количество остановок маршрута.
- `unique_stop_count` — количество уникальных остановок маршрута.

Если маршрут не найден:
```json
{
  "request_id": 1,
  "error_message": "not found"
}
```

**Получение информации об остановке**
```json
{
  "id": 2,
  "type": "Stop",
  "name": "Stop Name"
}
```
- `type` — имеет значение `"Stop"`.
- `name` — название остановки.

Ответ на данный запрос имеет вид:
```json
{
  "buses": [
      "Bus Name 1",
	  "Bus Name 2"
  ],
  "request_id": 2
}
```
- `buses` — названия маршрутов, которые проходят через эту остановку. Отсортированы по алфавиту.
- `request_id` — равно `id` запроса `Stop`.

Если остановка не найдена:
```json
{
  "request_id": 2,
  "error_message": "not found"
}
```

**Запрос на построение карты**
```json
{
  "type": "Map",
  "id": 3
}
```
Ответ:
```json
{
  "map": "...",
  "request_id": 3
}
```
- `map` — строка с изображением карты в формате SVG.

**Запрос на построение маршрута**
```json
{
  "type": "Route",
  "from": "Start Stop",
  "to": "End Stop",
  "id": 4
}
```
- `type` — имеет значение `"Route"`.
- `from` — начальная остановка.
- `to` — конечная остановка.

Данный запрос построит маршрут от “Start Stop” до “End Stop”, если это возможно.
На маршруте может смениться несколько автобусов и автобусы могут использоваться повторно.
Будет выбран самый оптимальный по времени маршрут.

Ответ на запрос `Route`:
```json
{
    "request_id": "id запроса",
    "total_time": "",
    "items": [ ]
}
```
- `total_time` — суммарное время прохождения маршрута, в минутах.
- `items` — список элементов маршрута. Элементы маршрута бывают двух типов:
  - `Wait` — подождать нужное количество минут на остановке:
  ```json
  {
      "type": "Wait",
      "stop_name": "Stop X",
      "time": 10
  }
  ```
  - `Bus` — проехать `span_count` остановок на автобусе `bus`:
  ```json
  {
      "type": "Bus",
      "bus": "Bus Name",
      "span_count": 2,
      "time": 4.321
  }
  ```
Если маршрут не найден:
```json
{
    "request_id": "id запроса",
    "error_message": "not found"
}
```
</details>

## Инструменты разработки

Проект написан в Visual Studio Code. Язык программирования - C++17. Для сборки использовался плагин C/C++ Runner и компилятор gcc (MinGW-W64) версии 13.2.0.
